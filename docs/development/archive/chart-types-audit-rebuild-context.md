# Chart-Types-Audit Rebuild Context

**Date:** 2025-12-28
**Status:** Ready for clean rebuild
**Reason:** Directory became cluttered with partial outputs and multiple visualization attempts

---

## What Was Accomplished

### 1. Generator Script Fixed (COMPLETE ✓)

**File:** `scripts/generate_assurance_audit_elements.py`

**Bugs Fixed:**
1. **Line 233-242**: Added fallback logic in `_process_vertex()` for unknown chart IDs
   - Charts with `c:` prefix now default to `v:spec:chart` and `v:guidance:chart`

2. **Line 128-130**: Added fallback logic in `get_coupling_target()`
   - Unknown chart IDs return `('v:spec:chart', 'v:guidance:chart')`

**Result:** Generator now correctly produces V=13, E=31, F=9, χ=-9 for chart-types-audit

**Verification:**
```bash
python scripts/generate_assurance_audit_elements.py \
  v:spec:chart v:guidance:chart \
  v:spec:syllabus v:guidance:syllabus \
  v:spec:assurance_audit v:guidance:assurance_audit \
  c:learning-journey-module-01 \
  c:chart-types-audit
```

Expected output:
```
Vertices: 13
Edges: 31
Faces: 9
Euler characteristic (χ): -9
```

### 2. TDD Validation Passes (COMPLETE ✓)

**File:** `scripts/test_generator_validation.py`

**Test Results:** 7/7 tests PASS (100%)

The chart markdown file (`charts/chart-types-audit/chart-types-audit.md`) has the correct structure in its frontmatter:
- 13 vertices listed correctly
- 31 edges listed correctly
- 9 faces listed correctly
- Topology documented as V=13, E=31, F=9, χ=-9

**The markdown file itself is CORRECT and should be preserved.**

---

## What Needs to Be Done

### Clean Rebuild of Visualization Files

**Problem:** The `export_chart_direct.py` script only finds elements that exist as physical files. Chart instances (`c:chart-types-audit`, `c:learning-journey-module-01`) are self-referential and don't have separate files, so the export produces incomplete results (V=11, E=14, F=6).

**Solution:** Use the generator's expected output to create visualization files.

### Files to Clean/Remove from charts/chart-types-audit/

```
chart-types-audit.json (incomplete: V=11, E=14, F=6)
chart-types-audit.html (based on incomplete JSON)
chart-types-audit-complete.json (conversion attempt)
chart-types-audit-complete.html (from conversion)
chart-types-audit-viz.json (failed conversion attempt)
chart-types-audit-expected.json (KEEP - this is correct from generator)
chart-types-audit-expected-viz.html (old visualization)
```

**Files to KEEP:**
- `chart-types-audit.md` - **CORRECT**, has all elements in frontmatter
- `chart-types-audit-expected.json` - **CORRECT**, from generator (V=13, E=31, F=9, χ=-9)

---

## Correct Build Process

### Step 1: Generate Expected Structure
```bash
cd /Users/z/Documents/GitHub/knowledge-complex-demo

python scripts/generate_assurance_audit_elements.py \
  v:spec:chart v:guidance:chart \
  v:spec:syllabus v:guidance:syllabus \
  v:spec:assurance_audit v:guidance:assurance_audit \
  c:learning-journey-module-01 \
  c:chart-types-audit \
  --output charts/chart-types-audit/chart-types-audit-expected.json
```

**Expected output:**
- Vertices: 13
- Edges: 31
- Faces: 9
- χ = -9

### Step 2: Convert to Visualization Format

The generator output has this structure:
```json
{
  "vertices": ["b0:root", "v:spec:spec", ...],
  "edges": ["b1:couples-GS-root", ...],
  "faces": ["b2:spec-spec", ...],
  "metadata": {...}
}
```

The visualizer needs this structure:
```json
{
  "chart_id": "c:chart-types-audit",
  "elements": {
    "vertices": [{"id": "...", "name": "...", "type": "...", "element_type": "vertex"}, ...],
    "edges": [{"id": "...", "source": "...", "target": "...", "type": "...", "element_type": "edge"}, ...],
    "faces": [{"id": "...", "type": "...", "element_type": "face"}, ...]
  },
  "topology": {"euler_characteristic": -9, "dimension": 2}
}
```

**Key conversion needs:**
1. Parse edge IDs to infer source/target vertices
2. Add proper type classifications
3. Format as vertex/edge/face objects with element_type

### Step 3: Generate Visualization
```bash
python scripts/visualize_chart.py charts/chart-types-audit/chart-types-audit.json
```

---

## Expected Final Structure

**charts/chart-types-audit/ should contain:**
```
chart-types-audit.md              (EXISTING - correct frontmatter)
chart-types-audit.json            (NEW - converted from generator output, V=13, E=31, F=9)
chart-types-audit.html            (NEW - visualization from correct JSON)
chart-types-audit-audit-trail.md  (EXISTING - generated by audit script, correct)
```

**Remove/ignore:**
- All `-expected`, `-complete`, `-viz` variants
- Any files with V=11, E=14, F=6 (incomplete)

---

## Validation Checklist

After rebuild:

1. **JSON topology matches expected:**
   ```bash
   python -c "import json; d=json.load(open('charts/chart-types-audit/chart-types-audit.json')); print(f\"V={d['element_counts']['vertices']}, E={d['element_counts']['edges']}, F={d['element_counts']['faces']}, χ={d['topology']['euler_characteristic']}\")"
   ```
   Expected: `V=13, E=31, F=9, χ=-9`

2. **TDD validation still passes:**
   ```bash
   python scripts/test_generator_validation.py
   ```
   Expected: 7/7 tests PASS

3. **Visualization exists:**
   ```bash
   ls charts/chart-types-audit/chart-types-audit.html
   ```

4. **Markdown topology documented correctly:**
   ```bash
   grep "Euler Characteristic" charts/chart-types-audit/chart-types-audit.md
   ```
   Expected: `χ = V - E + F = 13 - 31 + 9 = **-9**`

---

## Key Insights for Fresh Session

1. **The chart markdown is CORRECT** - don't modify it
2. **The generator is CORRECT** - it produces the right structure
3. **The issue is visualization pipeline** - export_chart_direct.py can't handle self-referential chart instances
4. **Solution is simple**: Convert generator JSON → visualizer JSON → HTML
5. **Edge parsing is the tricky part**: Need to infer source/target from edge IDs like `e:verification:chart:spec`

---

## Suggested Approach for Clean Rebuild

1. Start fresh session in charts/chart-types-audit directory
2. Remove all JSON/HTML files except chart-types-audit.md
3. Run generator to create fresh expected.json
4. Write simple, focused conversion script (expected.json → viz.json)
5. Run visualizer on viz.json
6. Rename outputs to standard names (chart-types-audit.json, chart-types-audit.html)
7. Validate topology matches V=13, E=31, F=9, χ=-9
8. Done

---

## Edge ID Parsing Reference

**Pattern:** `e:type:source:target`

**Examples:**
- `e:verification:chart:spec` → source: `v:spec:chart`, target: `v:spec:spec`
- `e:validation:chart:guidance` → source: `v:spec:chart`, target: `v:guidance:guidance`
- `e:coupling:spec` → source: `v:spec:spec`, target: `v:guidance:spec`
- `e:verification:chart-types-audit:assurance_audit` → source: `c:chart-types-audit`, target: `v:spec:assurance_audit`

**Special cases:**
- Chart instance sources: `chart-types-audit` → `c:chart-types-audit`
- Chart instance sources: `learning-journey-module-01` → `c:learning-journey-module-01`
- Cross-domain edges: `spec-guidance:guidance-spec` → source: `v:spec:guidance`, target: `v:guidance:spec`

---

**END OF CONTEXT DUMP**

## Complete Assurance Verification Table

**Generated:** 2025-12-28
**Purpose:** Visual validation of chart-types-audit structure showing ALL assured documents with their complete edge details.

### How to Read This Table

Each row represents ONE assured document (vertex) and shows:
- **Verification Edge**: Source document → Spec it verifies against
- **Validation Edge**: Source document → Guidance it validates against  
- **Coupling Edge**: Spec ↔ Guidance pair (undirected, shared between multiple faces)
- **Face ID**: The assurance face that combines these 3 edges

**Note on "—" entries:** Some vertices have faces but their edges are part of the boundary complex internal structure (see boundary complex edges below table).

### Complete Verification Table

| Assured Document | Verification Edge | Validation Edge | Coupling Edge | Face ID |
|------------------|-------------------|-----------------|---------------|---------|
| `c:chart-types-audit` | `e:verification:chart-types-audit:assurance_audit`<br>`c:chart-types-audit` → `v:spec:assurance_audit` | `e:validation:chart-types-audit:assurance_audit`<br>`c:chart-types-audit` → `v:guidance:assurance_audit` | `e:coupling:assurance_audit`<br>`v:spec:assurance_audit` ↔ `v:guidance:assurance_audit` | `f:assurance:chart-types-audit` |
| `c:learning-journey-module-01` | `e:verification:learning-journey-module-01:syllabus`<br>`c:learning-journey-module-01` → `v:spec:syllabus` | `e:validation:learning-journey-module-01:syllabus`<br>`c:learning-journey-module-01` → `v:guidance:syllabus` | `e:coupling:syllabus`<br>`v:spec:syllabus` ↔ `v:guidance:syllabus` | `f:assurance:learning-journey-module-01` |
| `v:guidance:assurance_audit` | `e:verification:assurance_audit:guidance`<br>`v:guidance:assurance_audit` → `v:spec:guidance` | `e:validation:assurance_audit:guidance`<br>`v:guidance:assurance_audit` → `v:guidance:guidance` | `e:coupling:guidance`<br>`v:spec:guidance` ↔ `v:guidance:guidance` | `f:assurance:assurance_audit` |
| `v:guidance:chart` | `e:verification:chart:guidance`<br>`v:guidance:chart` → `v:spec:guidance` | `e:validation:chart:guidance`<br>`v:guidance:chart` → `v:guidance:guidance` | `e:coupling:guidance`<br>`v:spec:guidance` ↔ `v:guidance:guidance` | `f:assurance:chart` |
| `v:guidance:guidance` | (boundary edge)<br>`e:verification:guidance-guidance:spec-guidance`<br>`v:guidance:guidance` → `v:spec:guidance` | (boundary edge)<br>`b1:self-validation`<br>`v:guidance:guidance` → `b0:root` | `e:coupling:guidance`<br>`v:spec:guidance` ↔ `v:guidance:guidance` | `b2:guidance-guidance` |
| `v:guidance:spec` | `e:verification:guidance-spec:spec-guidance`<br>`v:guidance:spec` → `v:spec:guidance` | `e:validation:guidance-spec:guidance-guidance`<br>`v:guidance:spec` → `v:guidance:guidance` | `e:coupling:spec-guidance:guidance-spec`<br>`v:spec:guidance` ↔ `v:guidance:spec` | `f:assurance:guidance-spec` |
| `v:guidance:syllabus` | `e:verification:syllabus:guidance`<br>`v:guidance:syllabus` → `v:spec:guidance` | `e:validation:syllabus:guidance`<br>`v:guidance:syllabus` → `v:guidance:guidance` | `e:coupling:guidance`<br>`v:spec:guidance` ↔ `v:guidance:guidance` | `f:assurance:syllabus` |
| `v:spec:assurance_audit` | `e:verification:assurance_audit:spec`<br>`v:spec:assurance_audit` → `v:spec:spec` | `e:validation:assurance_audit:spec`<br>`v:spec:assurance_audit` → `v:guidance:spec` | `e:coupling:spec`<br>`v:spec:spec` ↔ `v:guidance:spec` | `f:assurance:assurance_audit` |
| `v:spec:chart` | `e:verification:chart:spec`<br>`v:spec:chart` → `v:spec:spec` | `e:validation:chart:spec`<br>`v:spec:chart` → `v:guidance:spec` | `e:coupling:spec`<br>`v:spec:spec` ↔ `v:guidance:spec` | `f:assurance:chart` |
| `v:spec:guidance` | `e:verification:spec-guidance:spec-spec`<br>`v:spec:guidance` → `v:spec:spec` | `e:validation:spec-guidance:guidance-spec`<br>`v:spec:guidance` → `v:guidance:spec` | `e:coupling:spec-guidance:guidance-spec`<br>`v:spec:guidance` ↔ `v:guidance:spec` | `f:assurance:spec-guidance` |
| `v:spec:spec` | (boundary edge)<br>`b1:self-verification`<br>`v:spec:spec` → `b0:root` | (boundary edge)<br>`e:validation:spec-spec:guidance-spec`<br>`v:spec:spec` → `v:guidance:spec` | `e:coupling:spec`<br>`v:spec:spec` ↔ `v:guidance:spec` | `b2:spec-spec` |
| `v:spec:syllabus` | `e:verification:syllabus:spec`<br>`v:spec:syllabus` → `v:spec:spec` | `e:validation:syllabus:spec`<br>`v:spec:syllabus` → `v:guidance:spec` | `e:coupling:spec`<br>`v:spec:spec` ↔ `v:guidance:spec` | `f:assurance:syllabus` |

**Total Assured Documents:** 12 out of 13 vertices

**Unassured Vertex:** `b0:root` (boundary anchor - intentionally unassured)

### Duplicate Check Results

✓ **Vertices:** 13 total, 13 unique - **NO DUPLICATES**
✓ **Edges:** 31 total, 31 unique - **NO DUPLICATES**
✓ **Faces:** 9 total, 9 unique - **NO DUPLICATES**

### Coverage Analysis

**All non-root vertices are assured** (12/12 = 100% coverage)

The boundary vertex `b0:root` is the topological anchor and does not require assurance. This is the correct and expected behavior.

### Boundary Complex Internal Edges

The boundary complex (SS, SG, GS, GG + root) has special edges that connect to `b0:root`:

- `b1:self-verification`: `v:spec:spec` → `b0:root`
- `b1:self-validation`: `v:guidance:guidance` → `b0:root`
- `b1:couples-GS-root`: `v:guidance:spec` → `b0:root`
- `b1:couples-SG-root`: `v:spec:guidance` → `b0:root`

These boundary edges (b1) allow self-referential specs/guidances (SS and GG) to be assured without infinite regress.

### Shared Coupling Edges

Several coupling edges are SHARED between multiple assurance faces:

- `e:coupling:spec`: Shared by v:spec:spec, v:spec:chart, v:spec:syllabus, v:spec:assurance_audit
- `e:coupling:guidance`: Shared by v:guidance:guidance, v:guidance:chart, v:guidance:syllabus, v:guidance:assurance_audit
- `e:coupling:spec-guidance:guidance-spec`: Shared by v:spec:guidance and v:guidance:spec

This is CORRECT behavior - coupling edges represent undirected relationships between spec-guidance pairs and are reused across all documents of those types.

### Structure Summary

**Boundary Complex (4 vertices, 4 faces):**
- `v:spec:spec` → `b2:spec-spec`
- `v:spec:guidance` → `f:assurance:spec-guidance`
- `v:guidance:spec` → `f:assurance:guidance-spec`
- `v:guidance:guidance` → `b2:guidance-guidance`

**Chart Type Specs/Guidances (6 vertices, 3 faces):**
- `v:spec:chart` + `v:guidance:chart` → 1 face
- `v:spec:syllabus` + `v:guidance:syllabus` → 1 face
- `v:spec:assurance_audit` + `v:guidance:assurance_audit` → 1 face

**Concrete Chart Instances (2 vertices, 2 faces):**
- `c:learning-journey-module-01` → `f:assurance:learning-journey-module-01`
- `c:chart-types-audit` → `f:assurance:chart-types-audit`

**Boundary Anchor (1 vertex, unassured):**
- `b0:root` (no face - this is the anchor)

**Total:** V=13, E=31, F=9, χ=-9 ✓ VERIFIED

---

**END OF UPDATED CONTEXT DUMP**
