# Audit Trail Walkthrough

This document provides a step-by-step walkthrough of how to create and verify a complete audit trail for a document.

## Overview

We'll trace the complete audit trail for `spec-for-charts.md`, showing:
1. How it's verified against its template
2. How it's validated by human review
3. How the assurance face completes the audit triangle

## Step 1: The Document Being Assured

**File:** [00_vertices/spec-for-charts.md](../../../00_vertices/spec-for-charts.md)

This is a specification document that defines what chart documents must contain. Key frontmatter:

```yaml
---
type: vertex/spec
extends: v:spec:spec
id: v:spec:chart
name: Specification for Chart Documents
version: 1.0.0
created: 2025-12-27
modified: 2025-12-27
dependencies: []
---
```

**Question:** How do we know this document is correct?

**Answer:** Through the assurance triangle: verification + validation + assurance.

## Step 2: Verification Edge (Automated Check)

**File:** [01_edges/verification-chart:spec.md](../../../01_edges/verification-chart:spec.md)

This edge documents that an automated tool verified the spec-for-charts document.

```yaml
---
type: edge/verification
extends: null
id: e:verification:chart:spec
name: Verification - Spec-for-Charts against Spec-for-Spec
source: v:spec:chart
target: v:spec:spec
source_type: vertex/spec
target_type: vertex/spec
orientation: directed
---
```

**Key Fields:**
- `source`: The document being verified (`spec-for-charts`)
- `target`: The template it must conform to (`spec-for-spec`)
- `type: edge/verification`: Indicates automated verification

**Body Content:**
- **Tool:** `verify_template_based.py`
- **When:** Date and time of verification
- **Result:** PASS or specific errors
- **Accountability:** Generated by tool, reviewed by engineer

### Running Verification

```bash
python scripts/verify_template_based.py 00_vertices/spec-for-charts.md --templates templates
```

**Expected Output:**
```
Verifying: 00_vertices/spec-for-charts.md
Template: templates/00_vertices/spec.md

✓ Frontmatter present
✓ All required fields present
✓ Field types correct
✓ Structure matches template

Verification: PASS
```

## Step 3: Validation Edge (Human Review)

**File:** [01_edges/validation-chart:guidance.md](../../../01_edges/validation-chart:guidance.md)

This edge documents that a human expert reviewed the spec-for-charts document against quality guidance.

```yaml
---
type: edge/validation
extends: null
id: e:validation:chart:guidance
name: Validation - Spec-for-Charts against Guidance-for-Charts
source: v:spec:chart
target: v:guidance:chart
source_type: vertex/spec
target_type: vertex/guidance
orientation: directed
---
```

**Key Fields:**
- `source`: The document being validated (`spec-for-charts`)
- `target`: The guidance it should meet (`guidance-for-charts`)
- `type: edge/validation`: Indicates human validation

**Body Content:**
- **Reviewer:** Human name/identifier
- **When:** Date and time of review
- **Criteria:** Checklist from guidance
- **Result:** APPROVED or specific issues
- **Accountability:** Signed off by authorized reviewer

### Validation Checklist (from guidance-for-charts)

The reviewer checks:
- [ ] Is the purpose clear?
- [ ] Are all required sections documented?
- [ ] Are constraints well-defined?
- [ ] Are examples helpful?
- [ ] Is it actionable?

### Accountability

**Critical:** Validation edges require human authority. The accountability section must identify:
- **Who** reviewed it (name, role)
- **When** they reviewed it (date, time)
- **What** their authority is (why they're qualified)

Example:
```markdown
## Accountability

**Reviewer:** Chief Engineer
**Date:** 2025-12-27T15:30:00Z
**Authority:** Repository maintainer with spec design responsibility
**Result:** APPROVED - all criteria met
```

## Step 4: Assurance Face (Complete Audit Triangle)

**File:** [02_faces/assurance-chart.md](../../../02_faces/assurance-chart.md)

This face connects three vertices in a triangle to attest that the document is fully assured.

```yaml
---
type: face/assurance
extends: null
id: f:assurance:chart
name: Assurance Face - Spec-for-Charts
vertices:
  - v:spec:chart          # The document being assured
  - v:guidance:chart       # The quality guidance
  - b0:root                # The boundary anchor (trust root)
edges:
  - e:verification:chart:spec      # Verification edge
  - e:validation:chart:guidance    # Validation edge
  - e:coupling:chart-guidance      # Coupling edge
orientation: oriented
---
```

**The Triangle:**

```
   spec-for-charts (S)
      /          \
     /            \
verification   validation
   /                \
  /                  \
guidance(G)----coupling----root(B0)
```

**What the Triangle Means:**
1. **Verification passed:** The spec structurally conforms to the template
2. **Validation approved:** A human reviewed it and confirmed quality
3. **Assurance attested:** The combination of verification + validation = assured

### Assurance Body Content

The assurance face body documents:
- **What was assured:** Summary of the document
- **Verification result:** Link to verification edge, result
- **Validation result:** Link to validation edge, reviewer, result
- **Assurance attestation:** Statement that both checks passed
- **Accountability:** Who created the assurance face (may be automated)

Example:
```markdown
## Assurance Summary

This assurance face attests that **spec-for-charts** has passed both:
- ✓ Verification (automated structural check)
- ✓ Validation (human quality review)

## Verification

Edge: e:verification:chart:spec
Tool: verify_template_based.py
Result: PASS
Date: 2025-12-27T14:00:00Z

## Validation

Edge: e:validation:chart:guidance
Reviewer: Chief Engineer
Result: APPROVED
Date: 2025-12-27T15:30:00Z

## Attestation

Based on successful verification and validation, spec-for-charts is ASSURED as of 2025-12-27T15:30:00Z.
```

## Step 5: Audit Verification

Now we can audit the entire chart to verify all documents are assured:

```bash
python scripts/audit_assurance_chart.py charts/chart-types-audit/chart-types-audit.md
```

**The audit checks:**
1. For each vertex (document) in the chart, does an assurance face exist?
2. Does each assurance face have both verification and validation edges?
3. Do all edges trace back to the root (boundary anchor)?

**Expected Output:**
```
Assurance Audit for Chart: chart-types-audit
==============================================

Checking vertex: v:spec:chart
  ✓ Assurance face found: f:assurance:chart
  ✓ Verification edge found: e:verification:chart:spec
  ✓ Validation edge found: e:validation:chart:guidance
  ✓ Traces to root: b0:root

Checking vertex: v:spec:assurance_audit
  ✓ Assurance face found: f:assurance:assurance_audit
  ✓ Verification edge found: e:verification:assurance_audit:spec
  ✓ Validation edge found: e:validation:assurance_audit:guidance
  ✓ Traces to root: b0:root

...

Vertices to Assure: 9
Assured Vertices: 9 (100%)

All vertices are assured!
Audit: PASS ✓
```

## Complete Audit Trail Diagram

```
spec-for-charts.md (v:spec:chart)
│
├─→ VERIFICATION
│   │
│   ├─ Tool: verify_template_based.py
│   ├─ Target: spec-for-spec template
│   ├─ Result: PASS
│   └─ Edge: e:verification:chart:spec
│
├─→ VALIDATION
│   │
│   ├─ Reviewer: Chief Engineer
│   ├─ Guidance: guidance-for-charts
│   ├─ Result: APPROVED
│   └─ Edge: e:validation:chart:guidance
│
└─→ ASSURANCE
    │
    ├─ Triangle: (spec-for-charts, guidance-for-charts, root)
    ├─ Verification: ✓ PASS
    ├─ Validation: ✓ APPROVED
    └─ Face: f:assurance:chart
```

## Key Takeaways

1. **Verification** is automated structural checking (tool-based)
2. **Validation** is human quality review (expert-based)
3. **Assurance** is the combination of both (triangle pattern)
4. **Audit** verifies the complete trail exists and is valid

## Hands-On Exercise

Try creating an assurance trail for a new document:

1. Create a new spec document (e.g., `spec-for-foo.md`)
2. Run verification: `python scripts/verify_template_based.py 00_vertices/spec-for-foo.md --templates templates`
3. Create verification edge documenting the result
4. Perform human validation against guidance-for-spec
5. Create validation edge documenting your review
6. Create assurance face connecting the triangle
7. Add to a chart and run audit

## Related Documentation

- [Triangle Pattern Explained](triangle-pattern.md) - Deep dive into the pattern
- [Tooling Guide](tooling.md) - How to use audit scripts
- [Validation & Accountability](../../concepts/validation-accountability.md) - Governance concepts

---

**Note:** Every spec and guidance document in this repository follows this exact pattern, creating a complete audit trail for all documentation.
